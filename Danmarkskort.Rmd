---
title: "Danmarkskort"
author: "Andreas"
date: "4/3/2022"
output: html_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(sf)
library(rgdal)
library(readxl)
library(viridis)
```

Fra https://www.linkedin.com/pulse/easy-maps-denmark-r-mikkel-freltoft-krogsholm/

# Kort
```{r}
url = "https://api.dataforsyningen.dk/landsdele?format=geojson"
geofile = tempfile()
download.file(url, geofile)

geodata <- rgdal::readOGR(geofile, use_iconv = TRUE, encoding = 'UTF-8') #skriv geodata@data for at få en data frame
```

## Gennemsnitlig udd. landsdele
```{r}
udd_gns_2019 <- read_rds("Data/udd_gns_2019.rds") %>% 
  mutate(Landsdel = str_remove_all(string = Landsdel, pattern = "Landsdel")) %>%  #fjerner "Landsdel" fra navnene
  rename(gns_udd_score = gns) %>% arrange(desc(Landsdel))
udd_gns_2019
```

Man kan ikke joine eks. udd_gns_2019 og geodata@data af uvisse årsager. 
ggplotdata er den variabel som ggplot kan læse som et kort. Det er dog nødvendigt at der ikke er lavet om på rækkefølgen af rækkerne i geodata@data. Hvis der er det, passer navnene på landsdelene ikke længere. 

I ggplotdata kan man godt lave om på rækkefølgen af rækkerne. Derfor har jeg sorteret "navn" (landsdel) efter faldende, og gjort det samme i udd_gns_2019. Så kan der tilføjes søjlen med gns. udd. for hver landsdel, ved blot at 'indsætte' den med mutate. 



```{r}
ggplotdata = sf::st_as_sf(geodata)

ggplotdata2 <- data.frame(ggplotdata) %>% arrange(desc(navn)) %>% mutate(udd_gns = udd_gns_2019$gns_udd_score)
ggplotdata2
```
Metode som virker uden at indsætte ekstra data i geodata:

```{r}
ggplot(ggplotdata, aes(fill = navn)) +
  geom_sf() +
  theme_minimal()
```

Alternativ metode, som beskrevet:

```{r}
ggplot(ggplotdata2$geometry, aes(fill = ggplotdata2$navn)) +
  geom_sf() +
  theme_minimal() +
  labs(fill = "Landsdel")
```

```{r}
ggplot(ggplotdata2$geometry, aes(fill = ggplotdata2$udd_gns)) +
  geom_sf() +
  theme_minimal() +
  labs(fill = "Gennemsnitligt uddannennelsesniveau")
```

## Forskel i antal mænd og kvinder for landsdele

Lav relativ forskel.
```{r}
køn_landsdele_2019 <- read_rds("Data/køn_landsdele_2019.rds")
køn_landsdele_2019 <- køn_landsdele_2019 %>% mutate(Relativ_forskel = ((Mænd - Kvinder)/(Mænd + Kvinder))*100,
                                                    Landsdel = str_remove_all(string = Landsdel, pattern = "Landsdel")) %>% 
  arrange(desc(Landsdel))
køn_landsdele_2019
```

```{r}
ggplotdata2 <- ggplotdata2 %>% mutate(Diff_køn_relativ = køn_landsdele_2019$Relativ_forskel)
ggplotdata2
```
```{r}
ggplot(ggplotdata2$geometry, aes(fill = ggplotdata2$Diff_køn_relativ)) +
  geom_sf() +
  theme_minimal() +
  scale_fill_viridis(option = "plasma", direction = 1, alpha = 0.75, begin = 0.15, end = 0.85) +
  labs(fill = "Antal mænd - antal kvinder, \nforskel i procent") 
```
# Gennemsnitsindkomst landsdele

```{r}
gnsindkomst_landsdele_2019 <- read_rds("Data/gns_indkomst_landsdele_2019.rds")
gnsindkomst_landsdele_2019 <- gnsindkomst_landsdele_2019 %>% mutate(Landsdel = str_remove_all(string = Landsdel, pattern = "Landsdel")) %>% 
  arrange(desc(Landsdel))
gnsindkomst_landsdele_2019

ggplotdata2 <- ggplotdata2 %>% mutate(Gns_indkomst = gnsindkomst_landsdele_2019$Gns_indkomst)
```

```{r}
ggplot(ggplotdata2$geometry, aes(fill = ggplotdata2$Gns_indkomst)) +
  geom_sf() +
  theme_minimal() +
  labs(fill = "Gns. indkomst")
```

Til medianindkomst (eller deciler) kan IFOR22 eller IFOR32 muligvis anvendes. 

## Q10, Q50 og Q90 for landsdele

```{r}
deciler_landsdele <- read_rds("Data/deciler_landsdel_2019.rds")
deciler_landsdele <- deciler_landsdele %>% mutate(Landsdel = str_remove_all(string = Landsdel, pattern = "Landsdel")) %>% 
  arrange(desc(Landsdel))
deciler_landsdele
ggplotdata2 <- ggplotdata2 %>% mutate(Q10 = deciler_landsdele$Q10,
                                      Q50 = deciler_landsdele$Q50,
                                      Q90 = deciler_landsdele$Q90)
ggplotdata2
```


```{r}
ggplot(ggplotdata2$geometry, aes(fill = ggplotdata2$Q10)) +
  geom_sf() +
  theme_minimal() +
  labs(fill = "Q10")
```

```{r}
ggplot(ggplotdata2$geometry, aes(fill = ggplotdata2$Q50)) +
  geom_sf() +
  theme_minimal() +
  labs(fill = "Q50 - medianindkomst")
```

```{r}
ggplot(ggplotdata2$geometry, aes(fill = ggplotdata2$Q90)) +
  geom_sf() +
  theme_minimal() +
  labs(fill = "Q90")
```


# Brancher fordelinger (se Linear_regressions.Rmd)

Nedre 1/3 
```{r}
brancher_nedre <- read_excel("Data/brancher_beskæftigede_landsdele_nedre.xlsx")
brancher_nedre <- brancher_nedre %>% mutate(Landsdel = str_remove_all(string = Landsdel, pattern = "Landsdel"),
                                            Prop = Sum/Total_beskæftigede) %>% 
  arrange(desc(Landsdel))
brancher_nedre
```


Midte:
```{r}
brancher_midte <- read_excel("Data/brancher_beskæftigede_landsdele_midte.xlsx")
brancher_midte <- brancher_midte %>% mutate(Landsdel = str_remove_all(string = Landsdel, pattern = "Landsdel"),
                                            Prop = Sum/Total_beskæftigede) %>% 
  arrange(desc(Landsdel))
brancher_midte
```

Øvre 1/3:
```{r}
brancher_top <- read_excel("Data/brancher_beskæftigede_landsdele_øvre.xlsx")
brancher_top <- brancher_top %>% mutate(Landsdel = str_remove_all(string = Landsdel, pattern = "Landsdel"),
                                            Prop = Sum/Total_beskæftigede) %>% 
  arrange(desc(Landsdel))
brancher_top
```

```{r}
ggplotdata2 <- ggplotdata2 %>% mutate(prop_i_brancher_nedre = brancher_nedre$Prop,
                                      prop_i_brancher_midte = brancher_midte$Prop,
                                      prop_i_brancher_top = brancher_top$Prop)
ggplotdata2
```
```{r}
ggplot(ggplotdata2$geometry, aes(fill = ggplotdata2$prop_i_brancher_nedre)) +
  geom_sf() +
  theme_minimal() +
  labs(fill = "Andel i brancher med nedre 1/3\ni gns. barselsdage")
```
```{r}
ggplot(ggplotdata2$geometry, aes(fill = ggplotdata2$prop_i_brancher_midte)) +
  geom_sf() +
  theme_minimal() +
  labs(fill = "Andel i brancher med midterste 1/3\ni gns. barselsdage")
```
```{r}
ggplot(ggplotdata2$geometry, aes(fill = ggplotdata2$prop_i_brancher_top)) +
  geom_sf() +
  theme_minimal() +
  labs(fill = "Andel i brancher med øverste 1/3\ni gns. barselsdage")
```

