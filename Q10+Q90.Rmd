---
title: "Q10 og Q90 - Rebekka"
output: html_document
date: '2022-03-24'
---
```{r}
library(tidyverse)
library(statsDK)
library(readxl)
library(cowplot)
library(ggsci)

options(digits = 3)        # number of digits printed by R default (vectors, data.frames, lists)
options(pillar.sigfig = 3) # number of digits printed by tibbles default.

text_base_size   <- 8    # in pt
fig.witdh        <- 180  # in mm
fig.height       <- 125  # in mm

# Set all text in plots to same size
theme_set(theme_cowplot(font_size = 8, rel_small = 1, rel_tiny = 1, rel_large = 1))
# Setting output sizes for plots
knitr::opts_chunk$set(fig.width = fig.witdh/25.4)
knitr::opts_chunk$set(fig.height = fig.height/25.4)
knitr::opts_chunk$set(dpi = 108) # You need to find your minotors dpi yourself.

# Setting text size inside plots (geom_text, geom_label etc.)
ggplot_text_size <- text_base_size / ggplot2::.pt
# Now use: geom_text(..., size = ggplot_text_size)

# For saving plots!
# Use: ggsave(plot1, filename="myplot.png", width = fig.witdh, height=fig.height, units = "mm")
# Use: ggsave(plot1, filename="myplot.pdf", width = fig.witdh, height=fig.height, units = "mm")

# Set locale if you want danish month names etc.
Sys.setlocale(locale = "Danish_Denmark")  # For danish axes on plot
#Sys.setlocale(locale = "English_Denmark") # For english axes on plot

# Changing default ggplot colours
# see ?scale_fill_continuous
options(ggplot2.continuous.fill  = scale_fill_viridis_c)    
options(ggplot2.discrete.fill    = list(ggsci::pal_locuszoom()(7)) )
options(ggplot2.continuous.colour = scale_colour_viridis_c)
options(ggplot2.discrete.colour   = list(ggsci::pal_locuszoom()(7)))

```

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(statsDK)
library(tidyverse)
library(readxl)
```

Forklaring af Deciler:
https://www.dst.dk/Site/Dst/SingleFiles/GetArchiveFile.aspx?fi=arbejde-loen-og-indkomst&fo=deciler--pdf&ext={2}

Info om data (IFOR32):
Ved tolkning af 1. decil skal man være opmærksom på, at personer med store tab fx. på aktier eller selvstændig virksomhed kan trække indkomsten i 1. decil ned. Særligt i årene efter finanskrisen forekommer der ekstreme udsving. Tabellerne IFOR21 og IFOR22 giver et mere retvisende billede af udviklingen for laveste decil. Opdateret den 11. juni 2018 med reviderede data om skattefri kontanthjælp. 

```{r}
Q10Q90_kommune_2019 <- read_excel(path='Data/Q10Q90.xlsx')

Q10Q90_kommune_2019
```

Inddeler data i landsdele:
```{r}
kommune_landsdel <- read_excel(path='Data/kommuner_landsdele.xlsx')

#Fjerner kommune Christiansø, da denne ikke findes i datasæt IFOR32
kommune_landsdel <- kommune_landsdel[!(kommune_landsdel$Kommune=="Christiansø"),]

Q10Q90_landsdel_2019 <- Q10Q90_kommune_2019 %>% full_join(kommune_landsdel)

Q10Q90_landsdel_2019 <- Q10Q90_landsdel_2019 %>% group_by(Landsdel) %>% summarise(Q10 = mean(`1. decil`), Q90 = mean(`9. decil`), Antal_kommuner=n())

head(Q10Q90_landsdel_2019,11)
```


# Plot af farsbarsel fordelt på brancher 

```{r}
barsel11 <- read_rds("Data/barsel11.rds")
```

```{r}
head(barsel11)
```


```{r}
barsel11_far <- barsel11 %>% 
  filter(ENHED == "Far - Dage med barselsdagpenge efter fødsel (gennemsnit)", SEKTOR == "Sektor i alt", SOCIALSTATUS == "I alt", !BRANCHE %in% c("TOT Erhverv i alt", "11 Uoplyst aktivitet")) %>% 
  mutate(INDHOLD = parse_number(INDHOLD, locale = locale(decimal_mark = ",")), TID = factor(TID))
  
barsel11_far
```




```{r}
barsel11_far <- barsel11_far %>% arrange(INDHOLD)


plot_brancher <- barsel11_far %>% 
  ggplot(aes(x=BRANCHE, y=INDHOLD, col=TID)) +
  geom_point() +
  geom_hline(yintercept=c(20,30,40,50), color = "grey", size=0.1)+
  geom_line(aes(group=TID))+
  ylab("Gns. antal barselsdage for fædre")+
  xlab("Brancher")+
  scale_x_discrete("Brancher",
    labels = c(
      "1 Landbrug, skovbrug og fiskeri" = "A",
      "2 Industri, råstofindvinding og forsyningsvirksomhed" = "E",
      "3 Bygge og anlæg" = "B",
      "4 Handel og transport mv." = "D",
      "5 Information og kommunikation" = "H",
      "6 Finansiering og forsikring" = "J",
      "7 Ejendomshandel og udlejning" = "C",
      "8 Erhvervsservice" = "F",
      "9 Offentlig administration, undervisning og sundhed" = "I",
      "10 Kultur, fritid og anden service" = "G"
    ), 
      limits = c(
        "1 Landbrug, skovbrug og fiskeri",
        "3 Bygge og anlæg",
        "7 Ejendomshandel og udlejning",
        "4 Handel og transport mv.",
        "2 Industri, råstofindvinding og forsyningsvirksomhed",
        "8 Erhvervsservice",
        "10 Kultur, fritid og anden service",
        "5 Information og kommunikation",
        "9 Offentlig administration, undervisning og sundhed",
        "6 Finansiering og forsikring"))+
  theme_classic()+
  theme(text = element_text(size = 8), legend.position = c(.2,.75), legend.background = element_rect(fill="white", size=0.5, linetype="solid", colour ="black"))

plot_brancher

ggsave("Plots/Brancher_Barsel_far.png", plot = plot_brancher)
```



